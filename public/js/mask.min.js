function mask(c,b){if(!c){return}var a={fillStyle:"color",fillContent:"#cccccc",percent:100,radius:15,disable:false,touchstart:function(){},touchmove:function(){},touchend:function(){},complete:function(){},inited:function(){}};b=b||{};this.config=this.extend(b,a,false);this.target=c;this.ctx=this.target.getContext("2d");this.w=this.target.clientWidth;this.h=this.target.clientHeight;this.init()}mask.prototype={changeConfig:function(b){var c=this;for(var a in b){c.config[a]=b[a]}},disable:function(){var a=this;a.changeConfig({disable:true})},enable:function(){var a=this;a.changeConfig({disable:false})},clear:function(){var a=this;a.target.style.webkitTransitionDuration="500ms";a.target.style.MozTransitionDuration="500ms";a.target.style.msTransitionDuration="500ms";a.target.style.OTransitionDuration="500ms";a.target.style.transitionDuration="500ms";a.target.style.opacity=0;setTimeout(function(){a.ctx.clearRect(0,0,a.w,a.h);a.target.style.webkitTransitionDuration="0ms";a.target.style.MozTransitionDuration="0ms";a.target.style.msTransitionDuration="0ms";a.target.style.OTransitionDuration="0ms";a.target.style.transitionDuration="0ms";a.target.style.opacity=1},500)},init:function(){var j=this;var c=j.config;var k=j.target;var q=j.ctx;var p=j.w;var i=j.h;var a=false;k.width=p;k.height=i;k.style.backgroundColor="#ffffff";q.globalCompositeOperation="source-over";if(c.fillStyle=="color"){q.fillStyle=c.fillContent;q.fillRect(0,0,p,i);q.globalCompositeOperation="destination-out";k.style.backgroundColor="transparent";c.inited&&c.inited()}else{if(c.fillStyle=="image"){o(c.fillContent,function(){q.drawImage(this,0,0,p,i);q.globalCompositeOperation="destination-out";k.style.backgroundColor="transparent";c.inited&&c.inited()})}else{return false}}var n="ontouchstart" in window?true:false;var b=n?"touchstart":"mousedown";var e=n?"touchmove":"mousemove";var d=n?"touchend":"mouseup";k.addEventListener(b,f);k.addEventListener(d,g);k.addEventListener(e,l);function o(r,s){var h=new Image();h.src=r;if(h.complete){s.call(h);return}h.onload=function(){s.call(h)}}function f(h){h.preventDefault();if(c.disable){return false}if(h.changedTouches){h=h.changedTouches[h.changedTouches.length-1]}a=true;c.touchstart&&c.touchstart(h)}var m=1;function g(v){v.preventDefault();if(c.disable){return false}if(v.changedTouches){v=v.changedTouches[v.changedTouches.length-1]}a=false;c.touchend&&c.touchend(v);try{var u=q.getImageData(0,0,p,i).data;var t=0;for(var h=0;h<u.length;h+=4){if(u[h+3]==0){t++}}var s=parseInt(c.percent)/100;if(t>=p*i*s){j.clear();c.complete&&c.complete()}}catch(r){var s=parseInt(c.percent)/10;m++;if(m>s){j.clear();c.complete&&c.complete()}}}function l(s){s.preventDefault();if(c.disable){return false}if(a){if(s.changedTouches){s=s.changedTouches[s.changedTouches.length-1]}var r=k.getBoundingClientRect().left;var u=k.getBoundingClientRect().top;var h=s.clientX-r;var t=s.clientY-u;q.beginPath();q.arc(h,t,parseInt(c.radius),0,Math.PI*2);q.fill();c.touchmove&&c.touchmove(s)}}},extend:function(a,e,c,b){if(c===undefined){c=true}for(var d in e){if(c||!(d in a)){if(b){b(d)}else{a[d]=e[d]}}}return a}};
